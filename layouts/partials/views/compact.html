{{ $item := .item }}
{{ $link := $item.RelPermalink }}
{{ $target := "" }}
{{ if $item.Params.external_link }}
  {{ $link = $item.Params.external_link }}
  {{ $target = "target=\"_blank\" rel=\"noopener\"" }}
{{ end }}

{{/* --- 核心修改：逻辑判断 --- */}}
{{/* 定义一个变量：如果是 Event，则不使用特殊样式 */}}
{{ $is_event := eq $item.Type "event" }}
{{/* 定义特殊样式开关：只要不是 Event，就开启大图模式 */}}
{{ $use_special_style := not $is_event }}

<div class="media stream-item {{ if $use_special_style }}style-post-special{{ end }}">
  <div class="media-body">

    <div class="section-subheading article-title mb-0 mt-0">
      <a href="{{$link}}" {{ $target | safeHTMLAttr }}>{{ $item.Title }}</a>
    </div>

    {{/* 摘要显示逻辑 */}}
    {{ $show_summary := "" }}
    {{ if $item.Params.summary }}
      {{ $show_summary = $item.Params.summary }}
    {{ else }}
      {{ $show_summary = $item.Summary }}
    {{ end }}

    {{ with $show_summary }}
    <a href="{{ $link }}" {{ $target | safeHTMLAttr }} class="summary-link">
      <div class="article-style">
        {{ . }}
      </div>
    </a>
    {{ end }}

    <div class="stream-meta article-metadata">
      {{ if eq $item.Type "event" }}
      <div>
        <span>{{ partial "functions/get_event_dates" $item }}</span>
      </div>
      {{ end }}

      {{ if and $item.Params.authors (not (or (eq $item.Type "talk") (eq $item.Type "event"))) }}
      <div class="article-metadata">
        {{ partial "page_metadata_authors" $item }}
      </div>
      {{ end }}
    </div>
  </div>

  <div class="ml-3">
    {{ $resource := ($item.Resources.ByType "image").GetMatch "*featured*" }}
    {{ if not $resource }}
        {{ $resource = index ($item.Resources.ByType "image") 0 }}
    {{ end }}

    {{ with $resource }}
      {{/* --- 图片分流逻辑 --- */}}
      {{ if $use_special_style }}
          {{/* 情况A：不是 Event（即你的科研方向/Post），强制 800px 高清大图 */}}
          {{ $image := .Resize "800x" }}
          <a href="{{$link}}" {{ $target | safeHTMLAttr }}>
            <img src="{{ $image.RelPermalink }}" alt="{{ $item.Title }}" loading="lazy">
          </a>
      {{ else }}
          {{/* 情况B：是 Event，保持默认小图 (例如 300px 或主题默认) */}}
          {{/* 这里使用 Fill 截取正方形或 Resize 小图，保持列表整齐 */}}
          {{ $image := .Resize "300x" }}
          <a href="{{$link}}" {{ $target | safeHTMLAttr }}>
            <img src="{{ $image.RelPermalink }}" alt="{{ $item.Title }}" loading="lazy">
          </a>
      {{ end }}
    {{ end }}
  </div>
</div>